# How-to-build using OMake
#
# yes no | omake --install # to create OMakeroot for the first time

# If OMakeroot is here, include OMyMakefile
if $(file-exists OMakeroot)
   include OMyMakefile
   export

.PHONY: all install clean

OCAMLPACKAGEFLAGS=

# BYTE_ENABLED= true

OCAMLINCLUDES += 

OCAMLFLAGS    += -thread -bin-annot
OCAMLCFLAGS   +=
OCAMLOPTFLAGS += 
OCAML_LINK_FLAGS += 
OCAML_BYTE_LINK_FLAGS +=
OCAML_NATIVE_LINK_FLAGS +=

# CAMLP4PACKS[]=
#     orakuda

OCAMLPACKS[]= 
    eliom.server
    spotlib

FILES[] = 
   graffiti

# OCAMLDEPFLAGS= -syntax camlp4o -package orakuda.syntax
# OCAMLPPFLAGS = -syntax camlp4o -package orakuda.syntax

# MyOCamlProgram(spotinstall, $(FILES))
# 
# .PHONY: install
# install: spotinstall.opt
# 	install spotinstall.opt $(PREFIX)/bin/spotinstall

MyOCamlLibrary(graffiti, $(FILES))

.PHONY: start

start: graffiti.cmxs
    println("Starting server...")
    mkdir_if_not_exists(tmp/var/log/graffiti)
    mkdir_if_not_exists(tmp/var/run)
    mkdir_if_not_exists(tmp/var/data/graffiti/ocsipersist)
    # ocsigenserver.opt automatically replace .cma => cmxs in .conf
    ocsigenserver.opt -c graffiti-test.conf

# tmp/var/log/graffiti/errors.log
# tmp/var/log/graffiti/access.log
# tmp/var/log/graffiti/warnings.log
# tmp/var/run/graffiti-cmd
# tmp/var/data/graffiti/ocsipersist
